#sudo vi /etc/nginx/conf.d/tomcat-lb.conf

# tomcat-lb.conf: Simple HTTP round-robin to two public IPs

upstream tomcat_pool {
    server 172.31.27.222:8080 weight=7;   # Private IP of Tomcat-A
    server 172.31.30.134:8080 weight=3;  # Private IP of Tomcat-B
}

server {
    listen 80 default_server;   # Accept HTTP on port 80
    server_name devops.academy.test;  # ← your domain name here

    location / {
        proxy_pass         http://tomcat_pool;
        proxy_set_header   Host $host;             # Preserve original Host header
        proxy_set_header   X-Real-IP $remote_addr;# Tell Tomcat the real client IP
        proxy_connect_timeout 2s;                  # Fail fast if backends unreachable
        proxy_read_timeout    10s;                 # Give up if response is too slow
    }
}

# Testing Nginx configuration… and Reloading Nginx… "
# sudo nginx -t && sudo systemctl reload nginx
