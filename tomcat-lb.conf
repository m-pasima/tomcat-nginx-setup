# /etc/nginx/conf.d/tomcat-lb.conf
# tomcat-lb.conf: HTTP load balancing with basic health checks

#!/bin/bash
#
# install-nginx-lb.sh (RHEL 9 AWS EC2)
# Installs EPEL repository, Nginx, configures SELinux,
# and prepares firewall for HTTP connections.
#
# Usage:
#   sudo bash install-nginx.sh

set -euo pipefail

echo "1️⃣ Installing EPEL repo for RHEL 9 (AWS EC2)..."
dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm

echo "2️⃣ Installing Nginx..."
dnf install -y nginx

echo "3️⃣ Enabling and starting Nginx service..."
systemctl enable --now nginx

echo "4️⃣ Configuring firewall for HTTP (port 80)..."
if systemctl is-active --quiet firewalld; then
  firewall-cmd --permanent --add-service=http
  firewall-cmd --reload
fi

echo "5️⃣ Applying SELinux fix for Nginx outbound connections..."
setsebool -P httpd_can_network_connect 1

echo "✅ Installation complete. Nginx is running!"


# Testing Nginx configuration… and Reloading Nginx… "
# sudo nginx -t && sudo systemctl reload nginx
